#!/usr/bin/perl

use strict;
use warnings;

my $from = 2;
my $to = 10;


sub gen_for {
    my ($n) = @_;


    my @args = map { "x" . $_ } (1..$n);
    my $formals = join ",", @args;

    # gen accessors
    for my $nr (1..$n) {
        print "fun get${nr}of${n} ($formals) = x${nr}\n";
    }

    # gen setters
    my $var_name = "yy";
    for my $nr (1..$n) {
        my @members = @args;
        $members[$nr - 1] = $var_name;
        my $tuple = join ",", @members;
        print "fun set${nr}of${n} ($formals) ${var_name} = ($tuple)\n";
    }

    for my $nr (1..$n) {
        print "fun upd${nr}of${n} t f = set${nr}of${n} t (f (get${nr}of${n} t))\n";
    }
}


print "(* Autogenerated by tools/tupling.pl, do not modify *)\n\n";
print "structure Tupling = struct\n";
for ($from .. $to) {
    print "(* Tuples of $_ *)\n";
    gen_for $_;
    print "\n\n";
}
print "end;";
